<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css?family=Bungee" rel="stylesheet">
  <meta charset="utf-8">
  <title>Hustlr</title>
  <meta name="author" content="Hustlr Team" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" media="screen" href="style.css">
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="location.js"></script>
  <style>
    /* Always set the map height explicitly to define the size of the div
     * element that contains the map. */
    #map {
      height: 30em;
      width: 50em;
      left: 50%;
      margin-left: -35em;
      position: absolute;
      top: 5em;
      border: 3px solid white;
    }
    #background {
      position: absolute;
      top: 4.75em;
      border: 2em solid white;
      width: 66em;
      left: 50%;
      margin-left: -35.75em;
      margin-top: -0.5em;
      height: 27.5em;
      opacity: .5;
    }
    /* Optional: Makes the sample page fill the window. */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
  <style>
    #option-menu {
      position: absolute;
      top: 5em;
      left: 50%;
      margin-left: 15em;
    }
    #myUL {
        /* Remove default list styling */
        list-style-type: none;
        padding: 0;
        margin: 0;
        position: absolute;
        margin-top: 1px;
    }
    #myUL li a {
        border: 3px solid white; /* Add a border to all links */
        margin-top: -1px; /* Prevent double borders */
        margin-bottom: -3.5px;
        background-color: #3399FF; /* Grey background color */
        padding: 12px; /* Add some padding */
        text-decoration: none; /* Remove default text underline */
        font-size: 18px; /* Increase the font-size */
        color: white; /* Add a black text color */
        display: block; /* Make it into a block element to fill the whole list */
        width: 15em;
        height: 3.925em;
    }
    #myUL li a:hover:not(.header) {
        background-color: #2d86df; /* Add a hover effect to all links, except for headers */
    }
    #tags button {
        border: none;
    }
    .btn-group button {
    background-color: white; /* Green background */
    border: 0.1em solid #3399FF; /* Green border */
    color: #3399FF; /* White text */
    padding: 5px 12px; /* Some padding */
    cursor: pointer; /* Pointer/hand icon */
    float: left; /* Float the buttons side by side */
    position: relative;
    bottom: 0;
    left: 0;
    font-size: 1em;
    width: 15em;
    }
    .btn-group:after {
    content: "";
    clear: both;
    display: table;
    }
    .btn-group button:not(:last-child) {
    border-right: none; /* Prevent double borders */
    }
/* Add a background color on hover */
    /*.btn-group button: {
    background-color: #3399FF;
    color: white;
    }*/
    .btn-group button:active {
    background-color: #3399FF;
    color: white;
    }
    .btn-group button:not(:last-child) {
    border-right: none; /* Prevent double borders */
    }
    .active button{
      background-color: #3399FF;
      color: white;
    }
  </style>
</head>
<body>
<!-- particles.js container -->
<div id="particles-js">
</div>

<!-- scripts -->
<script src="particles.min.js"></script>
<script src="app.js"></script>
<div id="background">
  <div id="footer" style="position: absolute; top: 720px;left: 87px; z-index: -99999999;font-size: 45px">
    <p style="font-family: 'Bungee', cursive;font-weight: 30px;color: white;size: 30px;">Hustlr Team 2017</p>
  </div>
  <div id="logo" style="position: absolute; top: 700px; z-index: -99999999;">
  <img src="hustlr.png" style="width:70px;height:80px;opacity:1;">
</div>
</div>
<div id="map"></div>
</div>
<div id="option-menu">  
    <ul id="myUL">
      <li id="potential-competitors"><a href="#">Potential Competitors</a></li>
      <li id="optimal-location"><a href="#">Optimal Location</a></li>
      <li id="relative-interest"><a href="#">Relative Interest<br/><span id="interest"></span></a></li>
      <li id="supply-recommendations"><a href="#"><input style="border: none;font-size: 14px; font-family: 'Bungee', cursive; color: white; background-color: #3399FF; " type="text" placeholder="Latitude..."></a></li>
      <li><a href="#"><input style=" border: none; font-size: 14px; font-family: 'Bungee', cursive; color: white; background-color: #3399FF; " type="text" placeholder="Longitude..."></a></li>
    </ul>
  </div>
<div class="btn-group" style="position: relative;left: 0px;bottom: 100px;" align="center">
  <ul style="position: absolute; left: 50%; margin-left: -37.5em; margin-top: -11em">
    <li class="toggle" data="cafe" style="position: relative; display: inline;" ><button>Cafe</button></li>
    <li class="toggle" data="bakery" style="position: relative; display: inline;"><button>Bakery</button></li>
    <li class="toggle" data="restaurant" style="position: relative; display: inline;"><button>Restaurant</button></li>
    <li class="toggle" data="food" style="position: relative; display: inline;"><button>Food</button></li>
    <li class="toggle" data="store" style="position: relative; display: inline;"><button>Store</button></li>
    <li class="toggle" data="points_of_interest" style="position: relative; display: inline;"><button>P.O.I.</button></li>
    <li class="toggle" data="establishment" style="position: relative; display: inline;"><button>Establishment</button></li>
    <li class="toggle" data="home_goods_store" style="position: relative; display: inline;"><button>Home Goods</button></li>
    <li class="toggle" data="Tech" style="position: relative; display: inline;"><button>Tech</button></li>
    <li class="toggle" data="bar" style="position: relative; display: inline;"><button>Bar</button></li>
    <li class="toggle" data="grocery_or_supermarket" style="position: relative; display: inline;"><button>Grocery</button></li>
    <li class="toggle" data="liquor_store" style="position: relative; display: inline;"><button>Liquor Store</button></li>
    <li class="toggle" data="department_store" style="position: relative; display: inline;"><button>Department Store</button></li>
    <li class="toggle" data="electronics_store" style="position: relative; display: inline;"><button>Electronics Store</button></li>
    <li class="toggle" data="clothing" style="position: relative; display: inline;"><button>Clothing</button></li>
    <li class="toggle" data="lodging" style="position: relative; display: inline;"><button>Lodging</button></li>
    <li class="toggle" data="health" style="position: relative; display: inline;"><button>Health</button></li>
    <li class="toggle" data="meal_takeaway" style="position: relative; display: inline;"><button>Meal Takeaway</button></li>
    <li class="toggle" data="jewelery" style="position: relative; display: inline;"><button>Jewelery</button></li>
  </ul>
</div>
<script>
$('.toggle').click(function () {
    $(this).toggleClass('active');
});
  var map;
  var markersArray = [];
  function getMatch(a, b) {
    var matches = [];
    for ( var i = 0; i < a.length; i++ ) {
        for ( var e = 0; e < b.length; e++ ) {
            if ( a[i] === b[e] ) matches.push( a[i] );
        }
    }
    return matches;
  }
  function sigmoid(t) {
    return 1/(1+Math.pow(Math.E, -t));
}
  function clearOverlays() {
    for (var i = 0; i < markersArray.length; i++ ) {
      markersArray[i].setMap(null);
    }
    markersArray.length = 0;
  };
  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 42.54457119999999, lng: -76.5983802},
    zoom: 8
  });
  $(document).ready(function(){
      $("#potential-competitors").click(function(){
          clearOverlays();
          var raw = document.getElementsByClassName("toggle active");
          var tags = [];
          for(var i = 0; i < raw.length; i++) {
            tags.push(raw[i].getAttribute("data"));
          }
          $.get("http://api.reimaginebanking.com/merchants?lat=42.54457119999999&lng=-76.5983802&rad=10&key=faa42463727cc73a03c766e63a424800", function(data, status){
              for(var i = 0; i < data["data"].length; i++) {
                if(getMatch(tags, data["data"][i].category).length > 0) {
                  var marker = new google.maps.Marker({
                    position: {lat: data["data"][i].geocode.lat, lng: data["data"][i].geocode.lng},
                    map: map,
                    title: data["data"][i].name
                  });
                  markersArray.push(marker);
                }
              }
          });
      });
      $("#optimal-location").click(function(){
        clearOverlays();
        var raw = document.getElementsByClassName("toggle active");
        var tags = [];
        for(var i = 0; i < raw.length; i++) {
          tags.push(raw[i].getAttribute("data"));
        }
        $.get("http://api.reimaginebanking.com/merchants?lat=42.54457119999999&lng=-76.5983802&rad=10&key=faa42463727cc73a03c766e63a424800", function(data, status){
            var competitors = [];
            for(var i = 0; i < data["data"].length; i++) {
              if(getMatch(tags, data["data"][i].category).length > 0) {
                latlng = [data["data"][i].geocode.lat, data["data"][i].geocode.lng];
                competitors.push(latlng);
              }
            }
            var point = preprocessData(competitors, [42.54457119999999,-76.5983802], 7, 1000);
            var marker = new google.maps.Marker({
              position: {lat: point[0], lng: point[1]},
              map: map,
              title: "Optimal Location"
            });
            markersArray.push(marker);
        });
      });
      $("#relative-interest").click(function(){
        var userIDs = ["59e344f5ceb8abe24252f856"];
        for(var i = 0; i < userIDs.length; i++) {
          $.ajax({
            url: "https://westus.api.cognitive.microsoft.com/recommendations/v4.0/models/8810bcf5-12c3-4af9-b26f-c09cbf52ca8f/recommend/user?userId=" + userIDs[i] + "&numberOfResults=5",
            type: "GET",
            beforeSend: function(xhr){xhr.setRequestHeader('Ocp-Apim-Subscription-Key', '586a2994e7cb4523beb170e60f0954c3');},
            success: function(data) {
              $.get("http://api.reimaginebanking.com/merchants/" + data.recommendedItems[0].items[0].id + "?key=faa42463727cc73a03c766e63a424800", function(data, status){
                  /*alert(data.name);
                  alert(data.category);*/
                  var raw = document.getElementsByClassName("toggle active");
                  var tags = [];
                  for(var i = 0; i < raw.length; i++) {
                    tags.push(raw[i].getAttribute("data"));
                  }
                  document.getElementById("interest").innerHTML = sigmoid(5 * getMatch(tags, data.category).length / data.category.length);
              });
            }
          })
        }
      });
  });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJ1K3jkUOcucg5rPlCO_VLqNtxKKV9QmE&callback=initMap"
async defer ></script>
</body>
</html>